import{a as at}from"./chunk-FM7357LY.js";import{a as it}from"./chunk-X2UG4U34.js";import{a as rt}from"./chunk-QVNXAATV.js";import{b as ot}from"./chunk-HCK6XDZ4.js";import{d as tt}from"./chunk-DB5QDU4S.js";import{a as V,c as j,d as W}from"./chunk-RJTXM5ZD.js";import{c as et}from"./chunk-HQNA5BWE.js";import{a as Y,f as Z}from"./chunk-6TLKWYRX.js";import"./chunk-5AZGDEH3.js";import{A as Q,B as K,D as $,E as H,b as N,d as g,f as P,g as O,j as A,l as E,m as L,o as U,p as D,q as B,r as G,s as q,t as R,u as z}from"./chunk-OZWR4GVN.js";import{c as I,i as k,ka as J,la as X,ma as nt}from"./chunk-C43LEC2K.js";import"./chunk-CARY4E7O.js";import{Ab as b,Db as m,Dc as F,Fb as f,Jb as v,Kb as C,Lb as M,Nb as a,Pb as w,Ua as u,Va as d,Wb as y,ea as s,ja as h,kb as _,mb as c,ra as x,sa as S,vb as n,wb as o,xb as p,xc as T}from"./chunk-XR6OUCGQ.js";var st=["textarea"];function mt(l,ut){if(l&1){let t=b();n(0,"div",12)(1,"button",13),m("click",function(){x(t);let i=f();return S(i.acceptSuggestion())}),a(2),o(),p(3,"br")(4,"br"),o()}if(l&2){let t=f();u(2),w(" ",t.suggestion," ")}}var qt=(()=>{class l{constructor(t,e){this.service=t,this.router=e,this.title="",this.content="",this.formulation={id:0,title:"",content:""},this.allProducts=[],this.fb=s(D),this.navegateService=s(nt),this.id=0,this.db=s(ot),this.unitService=s(at),this.productService=s(it),this.PRODUCTS=[],this.UNITS=[],this.ALL_SUGGESTIONS=[],this.text="",this.suggestion="",this.updateUnits("Liquid")}ngOnInit(){this.form=this.fb.group({title:[this.formulation.title,g.required],content:[this.formulation.content,g.required]})}updateUnits(t){t!=null&&t!=null&&(this.UNITS=this.unitService.getUnitsByProductType(t),this.PRODUCTS=this.getProductNames(),this.UNITS.length>0?this.ALL_SUGGESTIONS=[...new Set([...this.PRODUCTS,...this.UNITS])].sort():this.UNITS=["oz","fl oz","gal","L","mL","g","kg","lb","ft","m","sq ft","sq m"])}getProductNames(){let t=this.productService.products(),e=[];return t!=null&&t!=null&&(e=t.map(i=>i.name)),e}save(){let t={id:Date.now(),title:this.form.value.title,content:this.form.value.content};this.db.addFormulations(t),this.goBack()}goBack(){this.navegateService.goFavorites("formulations",this.id)}cancel(){this.goBack()}handleInputChange(){this.form.get("content")?.valueChanges.subscribe(e=>{this.text=e});let t=this.text.match(/(\S+)$/);if(t&&t[1]){let e=t[1],i=this.ALL_SUGGESTIONS.find(r=>r.toLowerCase().startsWith(e.toLowerCase())&&r.toLowerCase()!==e.toLowerCase());this.suggestion=i||""}else this.suggestion=""}acceptSuggestion(){if(!this.suggestion)return;let t=this.text.match(/(\S+)$/),e;if(t){let i=t[1];e=this.text.substring(0,this.text.length-i.length)+this.suggestion+" "}else e=this.text+this.suggestion+" ";this.text=e,this.form.get("content")?.setValue(this.text),this.suggestion="",setTimeout(()=>this.textareaRef.nativeElement.focus(),0)}handleKeyDown(t){(t.key==="Tab"||t.key==="Enter")&&this.suggestion&&(t.preventDefault(),this.acceptSuggestion())}static{this.\u0275fac=function(e){return new(e||l)(d(rt),d(k))}}static{this.\u0275cmp=h({type:l,selectors:[["app-formulation-add"]],viewQuery:function(e,i){if(e&1&&v(st,5),e&2){let r;C(r=M())&&(i.textareaRef=r.first)}},standalone:!0,features:[y],decls:27,vars:3,consts:[["color","primary",1,"mobile-toolbar"],["mat-icon-button","","aria-label","Back",3,"click"],[1,"toolbar-title"],[1,"formulation-card"],[1,"form-content",3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","title","required",""],["class","w-full h-16 flex items-center justify-center mt-2 pat",4,"ngIf"],["matInput","","placeholder","Suspend 1 oz ft..","rows","6","formControlName","content","required","",3,"input","keydown"],[1,"button-group"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-raised-button","","color","warn","type","button",3,"click"],[1,"w-full","h-16","flex","items-center","justify-center","mt-2","pat"],[1,"bg-cyan-600","text-white","text-lg","font-semibold","px-6","py-3","rounded-lg","shadow-lg","transform","active:scale-95","transition-transform","duration-100","ease-in-out",3,"click"]],template:function(e,i){e&1&&(n(0,"mat-toolbar",0)(1,"button",1),m("click",function(){return i.cancel()}),n(2,"mat-icon"),a(3,"arrow_back"),o()(),n(4,"span",2),a(5,"Add Formulation"),o()(),n(6,"mat-card",3)(7,"form",4),m("ngSubmit",function(){return i.save()}),n(8,"mat-form-field",5)(9,"mat-label"),a(10,"Title"),o(),p(11,"input",6),o(),_(12,mt,5,1,"div",7),n(13,"mat-form-field",5)(14,"mat-label"),a(15,"Formulation"),o(),n(16,"textarea",8),m("input",function(){return i.handleInputChange()})("keydown",function(lt){return i.handleKeyDown(lt)}),a(17,"    "),o()(),n(18,"div",9)(19,"button",10)(20,"mat-icon"),a(21,"save"),o(),a(22,"\xA0Save "),o(),n(23,"button",11),m("click",function(){return i.cancel()}),n(24,"mat-icon"),a(25,"cancel"),o(),a(26,"\xA0Cancel "),o()()()()),e&2&&(u(7),c("formGroup",i.form),u(5),c("ngIf",i.suggestion),u(7),c("disabled",i.form.invalid))},dependencies:[F,T,I,B,A,N,P,O,U,R,q,W,V,j,H,$,Q,z,X,J,Z,Y,tt,et,G,E,L,K],styles:[".formulation-form[_ngcontent-%COMP%]{padding:1rem;display:flex;flex-direction:column;gap:1rem}.actions[_ngcontent-%COMP%]{display:flex;gap:1rem}mat-card[_ngcontent-%COMP%]{max-width:600px;margin:20px auto;padding:20px}.full-width[_ngcontent-%COMP%]{width:100%}.button-group[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:20px;gap:10px}[_nghost-%COMP%]{display:flex;flex-direction:column;height:100vh;background-color:#f9f9f9}.formulation-card[_ngcontent-%COMP%]{padding:16px;margin:8px 0;border:1px solid #ccc;border-radius:8px;height:100%}.custom-textarea[_ngcontent-%COMP%]{font-size:19px!important;color:#000!important;-webkit-text-fill-color:#000!important;opacity:1!important;font-family:inherit;background-color:transparent}mat-toolbar[_ngcontent-%COMP%]{flex:0 0 auto}.full-width[_ngcontent-%COMP%]{width:100%;flex:1}.pat[_ngcontent-%COMP%]{margin-bottom:16 px;padding-bottom:10 px}"]})}}return l})();export{qt as FormulationAddComponent};
