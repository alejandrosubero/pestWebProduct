

<mat-toolbar color="primary" class="toolbar mobile-toolbar">
  <mat-icon (click)="back()">arrow_back</mat-icon>
  <span> </span>
  <h2 class="mat-headline section-title">{{ title }}</h2>
</mat-toolbar>
<div class="comparison-container">

    <div class="product-selectors">
        <mat-form-field appearance="fill">
            <mat-label>Product 1</mat-label>
            <mat-select [(value)]="selectedProducts[0]">
                <mat-option *ngFor="let p of products" [value]="p">{{ p.title }}</mat-option>
            </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill">
            <mat-label>Product 2</mat-label>
            <mat-select [(value)]="selectedProducts[1]">
                <mat-option *ngFor="let p of products" [value]="p">{{ p.title }}</mat-option>
            </mat-select>
        </mat-form-field>
    </div>

    <ng-container *ngIf="selectedProducts.length === 2 && selectedProducts[0] && selectedProducts[1]">
        <div class="mode-toggle">
            <button mat-raised-button color="primary" (click)="toggleQuickCompare()">
                <mat-icon>{{ quickCompare ? 'list' : 'rule' }}</mat-icon>
                {{ quickCompare ? 'Mostrar Todo' : 'Comparación Rápida' }}
            </button>
        </div>

        <div *ngIf="quickCompare" class="differences-counter">
            <mat-icon color="warn">warning</mat-icon>
            Se encontraron <strong>{{ countDifferences() }}</strong> diferencias entre los productos.
        </div>

        <mat-accordion>
            <mat-expansion-panel *ngFor="let field of fields" [hidden]="quickCompare && !isDifferent(field)">
                <mat-expansion-panel-header>
                    <mat-panel-title>{{ formatFieldName(field) }}</mat-panel-title>
                    <mat-panel-description>
                        <span *ngIf="quickCompare && isDifferent(field)" class="highlight">
                            Diferent
                        </span>
                    </mat-panel-description>
                </mat-expansion-panel-header>

                <table mat-table [dataSource]="[{}]" class="comparison-table">
                    <ng-container *ngFor="let p of nonNullSelectedProducts" [matColumnDef]="p.title || 'unknown'">
                        <td mat-cell *matCellDef="let element" [class.highlight-cell]="quickCompare && isDifferent(field)">
                            {{ p[field] || 'N/A' }}
                        </td>
                    </ng-container>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                </table>
            </mat-expansion-panel>
        </mat-accordion>
    </ng-container>
</div>
