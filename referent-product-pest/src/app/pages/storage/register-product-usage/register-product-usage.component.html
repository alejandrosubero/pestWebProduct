<mat-toolbar color="primary" class="mobile-toolbar">
    <button mat-icon-button (click)="onBackClick()" aria-label="Back">
        <mat-icon>arrow_back</mat-icon>
    </button>
    <span>Add Usage Record</span>
</mat-toolbar>

<div class="form-container">
    <form [formGroup]="usageForm" (ngSubmit)="onSave()">
        <mat-form-field appearance="fill" class="full-width">
            <mat-label>Product Name</mat-label>
            <mat-select formControlName="productName" required>
                <mat-option *ngFor="let p of myProducts" [value]="p.id">
                    {{ p.name }}
                </mat-option>
            </mat-select>
            <mat-error *ngIf=" usageForm.get('productName')?.invalid && usageForm.get('productName')?.touched  ">
                Product Name is required.
            </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width">
            <mat-label>Product ID</mat-label>
            <input matInput formControlName="productId" required />
            <mat-error *ngIf="usageForm.get('productId')?.invalid && usageForm.get('productId')?.touched ">
                Product ID is required.
            </mat-error>
        </mat-form-field>


        <mat-form-field appearance="fill" class="full-width">
            <mat-label>Current Quantity</mat-label>
            <input matInput formControlName="currentQuantity" readonly />
            <mat-error *ngIf=" usageForm.get('currentQuantity')?.invalid && usageForm.get('currentQuantity')?.touched">
                Current Quantity
            </mat-error>
        </mat-form-field>


        <mat-form-field appearance="fill" class="full-width">
            <mat-label>Quantity Used</mat-label>
            <input matInput type="number" formControlName="quantityUsed" required min="0.01" step="any" />
            <mat-error *ngIf="usageForm.get('quantityUsed')?.invalid && usageForm.get('quantityUsed')?.touched ">
                <span *ngIf="usageForm.get('quantityUsed')?.errors?.['required']">Quantity Used is required.</span>
                <span *ngIf="usageForm.get('quantityUsed')?.errors?.['min']">Quantity must be greater than 0.</span>
                <span *ngIf="usageForm.get('quantityUsed')?.errors?.['pattern']">Please enter a valid number.</span>
            </mat-error>
        </mat-form-field>


        <mat-form-field appearance="fill" class="full-width">
            <mat-label>Unit of Measure</mat-label>
            <input matInput formControlName="unitOfMeasure" required />
            <mat-error *ngIf="usageForm.get('unitOfMeasure')?.invalid && usageForm.get('unitOfMeasure')?.touched ">
                Unit of Measure is required.
            </mat-error>
        </mat-form-field>


        <mat-form-field appearance="fill" class="full-width">
            <mat-label>Usage Date</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="usageDate" required />
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf=" usageForm.get('usageDate')?.invalid && usageForm.get('usageDate')?.touched ">
                Usage Date is required.
            </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width">
            <mat-label>Notes</mat-label>
            <textarea matInput formControlName="notes" rows="3"></textarea>
        </mat-form-field>

        <div class="button-container">
            <button type="submit" mat-flat-button color="primary" class="save-button" [disabled]="usageForm.invalid">
                SAVE
            </button>
        </div>
    </form>
</div>